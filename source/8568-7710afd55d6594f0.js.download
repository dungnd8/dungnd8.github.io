(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8568],{72431:function(){},78794:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return auth_AuthProvider}});var n=r(57437),i=r(46838),a=r(2265),o=r(9433),l=r(58746),s=r(63544),u=r(1815),d=r(54854),c=r(92332),_=r(51151),component_Unauthorized=()=>(0,n.jsx)(o.W,{children:(0,n.jsxs)(l.K,{align:"center",mt:"80",children:[(0,n.jsx)(s.k,{variant:"light",radius:"md",size:"xl",children:(0,n.jsx)(_.Z,{})}),(0,n.jsx)(u.D,{fz:"lg",children:"Unauthorized"}),(0,n.jsxs)(d.x,{children:[(0,n.jsx)(c.x,{ta:"center",fz:"md",w:350,fw:500,c:"dimmed",children:"Your authorization was unsuccessful."}),(0,n.jsx)(c.x,{ta:"center",fz:"md",w:350,fw:500,c:"dimmed",children:"Please ensure you are opening this page on Telegram app and try refreshing the page."})]})]})}),p=r(93764),E=r(24033),f=r(53771),h=r(32506),m=r(74036),v=r(55764);let signUp=e=>m.o.post("api/v1/bot/auth/sign-up",e).then(e=>e.data),useSignUp=()=>(0,v.useMutation)({mutationFn:signUp});var A=r(74833),g=r(69466),R=r(3031),T=r(37429);let getRefCodeFromParams=e=>{var t,r;return e?e.startsWith("ref")?e.split("_")[1]:e.includes("__ref")?null==e?void 0:null===(r=e.split("__"))||void 0===r?void 0:null===(t=r.find(e=>e.startsWith("ref")))||void 0===t?void 0:t.split("_")[1]:"":""};var auth_AuthProvider=({children:e})=>{let t=(0,i.kD)(),r=(0,E.useParams)(),{searchParams:o}=(0,T.o)(),l=o.get("tgWebAppStartParam"),s=getRefCodeFromParams(l),[u,d]=(0,a.useState)("un-check"),{mutateAsync:c}=useSignUp(),{data:_,isFetched:m}=(0,R.D)("authorized"===u),{token:v,profile:S,setSession:P,clearSession:I,setPackage:D,setProfile:L}=(0,A.a)(e=>({token:e.token,profile:e.profile,setSession:e.setSession,clearSession:e.clearSession,setPackage:e.setPackages,setProfile:e.setProfile})),handleSignIn=async()=>{try{var e,n,i,a;console.log("\uD83D\uDE80 ~ handleSignIn ~ refCode",s);let o=r.botId,l=new URLSearchParams(window.location.hash.slice(1)),u=(null==t?void 0:null===(e=t.components)||void 0===e?void 0:e.initDataRaw)||l.get("tgWebAppData");if(!u||!o){let e=u?"NO BOTID":"NO INITDATA";return(0,g.j)(g.O.UNAUTHORIZED,{category:e,label:`Error: ${e}`,nonInteraction:!0,sendToAmplitude:!0}),d("unauthorized")}let _=(0,p.wR)(u);if(v){console.log("\uD83D\uDE80 ~ handleSignIn ~ has token");let e=(0,f.o)(v);if(e.iat&&h.Z.unix(e.iat).isAfter(h.Z.unix(1702094488))&&e.exp&&h.Z.unix(e.exp).isAfter((0,h.Z)())&&e.username==(null==_?void 0:null===(i=_.user)||void 0===i?void 0:i.id)&&e.telegram_bot_id==o){d("authorized"),null===(a=t.setComponents)||void 0===a||a.call(t,{initData:_});return}}let E={};try{E={..._.user||{},tzOffset:new Date().getTimezoneOffset(),tz:h.Z.tz.guess(),tgWebAppVersion:l.get("tgWebAppVersion"),tgWebAppPlatform:l.get("tgWebAppPlatform")}}catch(e){}let m=await c({telegram_bot_id:o,telegram_mini_app_init_data:u,provider:"TELEGRAM_MINI_APP",profile:JSON.stringify(E),referral_code:s});if(!m){(0,g.j)(g.O.UNAUTHORIZED,{category:"NO RESPONSE USER SESSION",label:"Error: NO RESPONSE USER SESSION",nonInteraction:!0,sendToAmplitude:!0}),I(),d("unauthorized");return}P(m),L({...S,...E}),d("authorized"),null===(n=t.setComponents)||void 0===n||n.call(t,{initData:_})}catch(e){console.log("\uD83D\uDE80 handleSignIn ~ error:",e),(0,g.j)(g.O.UNAUTHORIZED,{category:"SOMETHING WRONG",label:`Error: ${e}`,nonInteraction:!0,sendToAmplitude:!0,amplitudeData:e}),I(),d("unauthorized")}};return((0,a.useEffect)(()=>{var e;if(t.didInit&&!(null===(e=t.components)||void 0===e?void 0:e.initData)){if(t.error){(0,g.j)(g.O.UNAUTHORIZED,{category:t.errorMessage,label:`Error: ${t.errorMessage}`,nonInteraction:!0,sendToAmplitude:!0}),d("unauthorized");return}handleSignIn()}},[t]),(0,a.useEffect)(()=>{if(m&&_){var e;D(null===(e=(0,R.H)(null==_?void 0:_.packages))||void 0===e?void 0:e[0]),L({...S,..._.profile,createdAt:_.createdAt,allowedTrialPremium:_.allowedTrialPremium,signupRefCode:_.signupRefCode})}},[m]),"unauthorized"===u)?(0,n.jsx)(component_Unauthorized,{}):e}},3031:function(e,t,r){"use strict";r.d(t,{D:function(){return useGetUserProfile},H:function(){return getLatestPkgValid}});var n=r(28285),i=r(32506),a=r(74573),o=r.n(a),l=r(74036);let getLatestPkgValid=e=>{let t=i.Z.utc(),r=null==e?void 0:e.filter(e=>(0,i.Z)(e.toTime)>t);return(null==r?void 0:r.length)?[o()(r,e=>(0,i.Z)(e.toTime).valueOf())]:[]},getUserProfile=()=>l.o.get("/api/v1/bot/users").then(e=>e),useGetUserProfile=e=>(0,n.useQuery)({enabled:e,cacheTime:6e4,queryKey:["user-profile"],queryFn:()=>getUserProfile()})},74833:function(e,t,r){"use strict";r.d(t,{a:function(){return o},j:function(){return l}});var n=r(94660),i=r(74810),a=r(7607);let o=(0,n.Ue)()((0,i.tJ)(e=>({isAuthorized:!1,setSession:t=>{e(()=>({isAuthorized:!0,token:t.token,referral_code:t.referral_code,packages:t.packages}))},clearSession:()=>{e(()=>({isAuthorized:!1,profile:void 0,token:void 0,referral_code:void 0}))},setPackages:t=>{e(()=>({packages:t}))},setProfile:t=>{e(e=>({profile:{...e.profile,...t}}))}}),{name:a.L,version:1})),l=(0,n.Ue)()(e=>({isUsedTelegramStartParams:!1,setUsedTelegramStartParams:()=>{e(()=>({isUsedTelegramStartParams:!0}))},clear:()=>{e(()=>({isUsedTelegramStartParams:!1}))}}))},7607:function(e,t,r){"use strict";r.d(t,{L:function(){return n},R:function(){return i}});let n="user_session",i="alert_filter_key"},37429:function(e,t,r){"use strict";r.d(t,{o:function(){return useHref}});var n=r(24033);let useHref=()=>{let e=(0,n.useSearchParams)(),t=(0,n.usePathname)(),r=t,i=null==e?void 0:e.toString();return i&&(r=`${r}?${i}`),{href:r,hrefWithQuery:(r,n)=>{let i=r||t,a=new URLSearchParams;(null==n?void 0:n.overrite)||e.forEach((e,t)=>{(null==n?void 0:n.clearQueries)&&n.clearQueries.includes(t)||a.append(t,e)}),(null==n?void 0:n.query)&&Object.entries(n.query).forEach(([e,t])=>{a.set(e,t)});let o=a.toString();return o?`${i}?${o}`:i},searchParams:e}}},4691:function(e,t,r){"use strict";r.d(t,{N:function(){return useMiniAppRouter}});var n=r(30565),i=r(24033);let useMiniAppRouter=()=>{let e=(0,i.useRouter)(),t=(0,i.useParams)(),r=(0,i.usePathname)(),[a,o]=(0,n.I)({key:"prevPathname",defaultValue:""}),clearPrevPathname=()=>{o("")};return{push:(r,n)=>{let i=t.botId?`/${t.botId}${r}${window.location.hash}`:`${r}${window.location.hash}`;e.push(i,n)},replace:(r,n)=>{let i=t.botId?`/${t.botId}${r}${window.location.hash}`:`${r}${window.location.hash}`;e.replace(i,n)},back:e.back,prevPathname:a,clearPrevPathname,setPrevPathname:e=>{o(e||r)},backToPrevPathname:t=>{e.push(a||t),clearPrevPathname()}}}},29488:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return AmptitudeProvider},initAmplitude:function(){return initAmplitude}});var n=r(2265),i=r(79524);let initAmplitude=()=>{i.S1("56390b218e715fbba6322aa146e5e1b3",{defaultTracking:{attribution:!1,pageViews:!0,sessions:!0,formInteractions:!1,fileDownloads:!1}})};function AmptitudeProvider(){return(0,n.useEffect)(()=>{initAmplitude()},[]),null}},74036:function(e,t,r){"use strict";r.d(t,{o:function(){return i}});var n=r(92173);let i=n.Z.create({withCredentials:!0,baseURL:"https://api.icrypto.ai"});i.interceptors.request.use(e=>{var t,r,n,i;((null===(t=e.url)||void 0===t?void 0:t.includes("/sign-up"))||(null===(r=e.url)||void 0===r?void 0:r.includes("/users")))&&console.log("\uD83D\uDE80 ~ axios ~ request:",e);try{let t=localStorage.getItem("user_session");if(t){let r=JSON.parse(t);(null==r?void 0:null===(n=r.state)||void 0===n?void 0:n.token)&&(e.headers.Authorization=`Bearer ${null==r?void 0:null===(i=r.state)||void 0===i?void 0:i.token}`)}}catch(e){console.log("\uD83D\uDE80 ~ file: index.ts:21 ~ axios.interceptors.request.use ~ error:",e)}return e}),i.interceptors.response.use(e=>{var t,r;return((null===(t=e.config.url)||void 0===t?void 0:t.includes("/sign-up"))||(null===(r=e.config.url)||void 0===r?void 0:r.includes("/users")))&&console.log("\uD83D\uDE80 ~ axios ~ response:",e.data),e.data},e=>Promise.reject(e))},32506:function(e,t,r){"use strict";var n=r(74548),i=r.n(n),a=r(6537),o=r.n(a),l=r(81565),s=r.n(l),u=r(38100),d=r.n(u),c=r(51068),_=r.n(c),p=r(75255),E=r.n(p);i().extend(o()),i().extend(s()),i().extend(d()),i().extend(_()),i().extend(E()),t.Z=i()},69466:function(e,t,r){"use strict";r.d(t,{O:function(){return a},j:function(){return gaEvent}});var n=r(36599),i=r(79524);r(29488);let trackAmplitudeEvent=(e,t)=>{i.j(e,t)},a={ALERT_CREATE_LIST:"alert_create_list",ALERT_CREATE_CREATE:"alert_create_create",ALERT_CREATE_EDIT:"alert_update_edit",ALERT_CREATE_EVENTYPE_SELECT:"alert_create_eventtype_select",ALERT_CREATE_TOKEN_SELECT:"alert_create_token_select",ALERT_CREATE_ADDRESS_SELECT:"alert_create_address_select",ALERT_CREATE_LABEL_SELECT:"alert_create_label_select",ALERT_CREATE_NETWORK_SELECT:"alert_create_network_select",ALERT_HISTORY_LIST:"alert_history_list",ALERT_HISTORY_FILTER:"alert_history_filter",EXPORE_ALERT:"explore_alert",ALERT_SHARE:"alert_share",ALERT_CLONE:"alert_clone",ALERT_SUBSCRIBE:"alert_subscribe",ALERT_SUBSCRIBE_ERROR:"alert_subscribe_error",ALERT_UNSUBSCRIBE:"alert_unsubscribe",ALERT_MUTE:"alert_mute",ALERT_ALLOW_NOTIFICATIONS:"alert_allow_notifications",ALERT_NOTIFICATIONS_ERROR:"alert_notifications_error",ALERT_DELETE_UNSUBSCRIBE_ERROR:"alert_delete_unsubscribe_error",CREATE_ALERT_FROM_EXPLORE:"create_alert_from_explore",OPEN_SHARED_ALERT:"open_shared_alert",PAYMENT:"payment",UNAUTHORIZED:"unauthorized"},gaEvent=(e,{sendToAmplitude:t,amplitudeData:r,...i}={})=>{try{t&&trackAmplitudeEvent(e,{amplitudeData:r,...i}),(0,n.B)(e,i)}catch(e){}}},46838:function(e,t,r){"use strict";r.d(t,{z8:function(){return s},Rl:function(){return u},kD:function(){return useMiniApp}});var n=r(57437),i=r(2265);let a=(0,i.createContext)({components:null,didInit:!1,error:!1});a.displayName="MiniAppContext";var o=r(36127),l=r(93764);let s=(0,i.memo)(({children:e,error:t=!1})=>{let[r,s]=(0,i.useState)(!1),[u,d]=(0,i.useState)(null),c=(0,o.z8)(),_=(0,o.Kx)(),p=(0,o.Sj)(),E=(0,o.wz)(),f=(0,o.iP)(),h=(0,o.nB)(),m=(0,o.kD)(),v=(0,o.BF)();(0,i.useEffect)(()=>{var e,t;c.isVisible&&(null==c||null===(e=c.hide)||void 0===e||e.call(c)),_.isVisible&&(null==_||null===(t=_.hide)||void 0===t||t.call(_)),p.isExpanded||p.expand(),d(e=>({...e||{},mainButton:c,backButton:_,initDataRaw:E,viewport:p,popup:v,teleTheme:f,utils:h,app:m,on:l.on,off:l.NB})),s(!0)},[]);let handleSetComponents=e=>{d(t=>({...t||{},...e}))},A=(0,i.useMemo)(()=>({components:u,didInit:r,error:t,setComponents:handleSetComponents}),[r,u]);return(0,n.jsx)(a.Provider,{value:A,children:e})});s.displayName="MiniAppProvider";let u=(0,i.memo)(({children:e,didInit:t=!1,error:r=!1,errorMessage:o})=>{let[l,s]=(0,i.useState)(null);(0,i.useEffect)(()=>{s(e=>({...e||{}}))},[]);let handleSetComponents=e=>{s(t=>({...t||{},...e}))},u=(0,i.useMemo)(()=>({components:l,didInit:t,error:r,errorMessage:o,setComponents:handleSetComponents}),[t,r,l]);return(0,n.jsx)(a.Provider,{value:u,children:e})});u.displayName="MiniAppWithoutSDKProvider";let useMiniApp=()=>(0,i.useContext)(a)}}]);